<!DOCTYPE html>
<html>
<head>
  <title>HDL ZIP Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <h2>HDL File Generator</h2>
  <textarea id="hdlText" rows="10" cols="80" placeholder="Paste HDL content here"></textarea><br><br>
  <button onclick="generateZip()">Download HDL ZIP</button>

  <script>
    // Generate ZIP with HDL content from textarea
    function generateZip() {
      const hdlContent = document.getElementById("hdlText").value;
      if (!hdlContent.trim()) {
        alert("Please enter HDL content.");
        return;
      }

      const zip = new JSZip();
      zip.file("CalculationCard.dat", hdlContent);

      zip.generateAsync({ type: "blob" }).then(function(content) {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(content);
        link.download = "CalculationCard.zip";
        link.click();
      });
    }

    // Helper to get URL param by name
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // On page load, check for 'hdl' param and auto-fill textarea
    window.onload = () => {
      const hdlEncoded = getQueryParam('hdl');
      if (hdlEncoded) {
        // Decode URL-encoded HDL text and set textarea
        const hdlText = decodeURIComponent(hdlEncoded);
        document.getElementById('hdlText').value = hdlText;

        // Auto-trigger download
        generateZip();
      }
    };
  </script>
</body>
</html>
